<!DOCTYPE html>
<html lang="en">
  <head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2976969447542443"
     crossorigin="anonymous"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2F7W0VSKYS"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-2F7W0VSKYS');
    </script>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta charset="UTF-8" content="fhYxFDAoOmgxHGUTBDoGAhwQJmoFBhYN3pgQrKJ-Uj5BuTuAJQ_S4pSX" csrf-param="_csrf_token" method-param="_method" name="csrf-token">
<meta content="rails, turbo" name="keywords"><meta content="How to render turbo frames within a multi-part form" name="description">
<title>How to render turbo frames within a multi-part form</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600&amp;display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600&amp;display=swap" rel="stylesheet">
    <link phx-track-static rel="stylesheet" href="css/app-02e14b945d8b05cb2897c7e476f6f184%EF%B9%96vsn=d.css"/>
    <script defer phx-track-static type="text/javascript" src="js/app-a031d7efdf9d092a14f7e85a21871ce8%EF%B9%96vsn=d.js"></script>
    <!-- SIDENAV SCRIPT -->
    <script type="text/javascript">
      /* Set the width of the side navigation to 250px */
      function openNav() {
        document.getElementById("mySidenav").style.width = "250px";
        document.getElementById("main").style.marginLeft = "250px";
        document.body.style.backgroundColor = "rgba(0,0,0,0.4)";

        var dropdown = document.getElementsByClassName("dropdown-btn");
        var i;
        for (i = 0; i < dropdown.length; i++) {
          dropdown[i].addEventListener("click", function() {
            this.classList.toggle("active");
            var dropdownContent = this.nextElementSibling;
            if (dropdownContent.style.display === "block") {
              dropdownContent.style.display = "none";
            } else {
              dropdownContent.style.display = "block";
            }
          });
        }
      }

      /* Set the width of the side navigation to 0 */
      function closeNav() {
        document.getElementById("mySidenav").style.width = "0";
        document.getElementById("main").style.marginLeft = "0";
        document.body.style.backgroundColor = "white";
      }
    </script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2976969447542443"
     crossorigin="anonymous"></script>
    <ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-2976969447542443"
     data-ad-slot="2745114693">
    </ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </head>
  <body>

    <div id="mySidenav" class="sidenav">
      <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
      <!-- FOR WHEN YOU NEED NESTED NAV USE THIS EXAMPLE -->
      <!-- <p class="dropdown-btn">Elixir Phoenix</p>
      <div class="dropdown-container">
        <a href="#">Link 1</a>
        <a href="#">Link 2</a>
      </div> -->
      <a href="page/about.html">About</a>
      <a href="page/attributions.html">Attributions</a>
    </div>

    <nav id="nav">
      <a href="index.html"><img id="logo" class="logo" src="images/logo-7c9e547c805c708decc674b648163720%EF%B9%96vsn=d.svg" alt="DevDecks icon" /></a>
      <a href="studio.html"><img id="settings-icon" class="nav-icon lg" src="images/studio-2-00b6814e1495c4cb9ff6987d9b98753f%EF%B9%96vsn=d.svg" alt="studio icon" /></a>
      <a id="darkmode-toggler"><img id="settings-icon" class="nav-icon" src="images/night-mode-41cf0bc8abaacbbd59e2fdca8ac55a85%EF%B9%96vsn=d.svg" alt="dark mode icon" /></a>
      <img id="settings-icon" onclick="openNav()" class="nav-icon" src="images/more-79c5db1b1206b6b8195fee1ceb385178%EF%B9%96vsn=d.svg" alt="more pages icon" />
    </nav>
    <br />
<main role="main" class="container">
  <p class="alert alert-info" role="alert"></p>
  <p class="alert alert-danger" role="alert"></p>
<div class="page blog-post">
  <div id="2022-rendering-a-turbo-frame-inside-a-form" style="margin-bottom: 3rem;">
<a class="all-posts-link" href="index.html">All posts</a>
    <div class="flex-row-d-column-m">
      <h1 class="link-title">How to render turbo frames within a multi-part form</h1>
      <time>2022-04-08</time>
    </div>

    <div class="flex-row-no-space">
      <img class="icon-sm" src="images/tag2-730d3eac769a667d071582853b151791%EF%B9%96vsn=d.svg" />&nbsp<a class="blog-tag" href="tags/rails.html">rails</a><a class="blog-tag" href="tags/turbo.html">turbo</a>
    </div>

    <div class="blog-post-body">
<p>
This is a code example of how to render a Turbo Frame within an html form. This is going to be an application that handles orders. You will need to generate an application and create the orders controller and order model. This was the command I used to generate this application, it uses esbuild for javascript and tailwind for the css. This is an example application I built to get exposure to Turbo.</p>
<pre><code class="ruby">rails new kitchen -j esbuild --css tailwind</code></pre>
<p>
The application functionality this examples is a multi-part form, which will show a new turbo frame for each step of the order the user has progressed to.</p>
<p>
This is what my migration change method looked like for the orders model:</p>
<pre><code class="ruby">def change
  create_table :orders do |t|
    t.string :name
    t.json :toppings, array: true, default: []
    t.integer :step, default: 1

    t.timestamps
  end
end</code></pre>
<p>
Then add a standard rails route and controller action to handle the incoming request that will render the html with the turbo frame(s).</p>
<p>
routes.rb</p>
<pre><code class="ruby">Rails.application.routes.draw do
  resources :orders
end</code></pre>
<p>
One thing to call out in the controller is on every update we redirect to the edit route so that the user can continue to fill out the multi-part form, until they hit the end of the steps in the form.</p>
<p>
orders_controller.rb</p>
<pre><code class="ruby">class OrdersController &lt; ApplicationController
  before_action :set_order, only: %i[ edit ]

  def edit
  end

  def update
    order = @order.update(order_params)

    if @order.step == 2
      return head :ok
    end

    respond_to do |format|
      if order
        format.html { redirect_to edit_order_path(@order), notice: &quot;Order was successfully updated.&quot; }
        format.json { render :show, status: :ok, location: @order }
      else
        format.html { render :edit, status: :unprocessable_entity }
        format.json { render json: @order.errors, status: :unprocessable_entity }
      end
    end
  end

  def set_order
      @order = Order.find(params[:id])
  end
end</code></pre>
<p>
Below is the orders model, which contains some hard coded data we will use in our template to render html options for checkboxes. Remember this is an example application, the data for TOPPINGS and EXTRAS should really be stored in a database.</p>
<p>
This model also contains a callback to increment each step on update. The <code class="inline">order#step</code> will be used to dyamically render the correct partial for the mutlti-step form.</p>
<p>
order.rb</p>
<pre><code class="ruby">class Order &lt; ApplicationRecord
  TOPPINGS = [&quot;perpperoni&quot;, &quot;sausage&quot;, &quot;red onion&quot;, &quot;banana peppers&quot;, &quot;anchovies&quot;]
  EXTRAS = [&quot;extra cheese&quot;, &quot;brownie&quot;, &quot;breadsticks&quot;]

  before_update :increment_step

  private

  def increment_step
    return if step == 2

    self.step = step + 1
  end
end</code></pre>
<p>
Then in the edit template render the form partial for order while passing in a local order variable:</p>
<pre><code class="ruby">&lt;%= render partial: &quot;form&quot;, locals: { order: @order } %&gt;</code></pre>
<p>
This is the standard scaffolded form for the orders views, but within it there is rendered, step. Based off of the step of the process the order is in, we will render a differ turbo frame within the form.</p>
<pre><code class="ruby">&lt;%= form_with(model: order) do |form| %&gt;
  &lt;% if order.errors.any? %&gt;
    &lt;div style=&quot;color: red&quot;&gt;
      &lt;h2&gt;&lt;%= pluralize(order.errors.count, &quot;error&quot;) %&gt; prohibited this order from being saved:&lt;/h2&gt;

      &lt;ul&gt;
        &lt;% order.errors.each do |error| %&gt;
          &lt;li&gt;&lt;%= error.full_message %&gt;&lt;/li&gt;
        &lt;% end %&gt;
      &lt;/ul&gt;
    &lt;/div&gt;
  &lt;% end %&gt;

  &lt;%= render partial: &quot;orders/steps/step_#{@step ? @step : order.step}&quot;, locals: { order: order, form: form } %&gt;
&lt;% end %&gt;</code></pre>
<p>
What follows are examples of two the step partials. In each of the individual partials we do a few things:</p>
<ol>
  <li>
Create a turbo frame using the <code class="inline">turbo_frame_tag</code> method.  </li>
  <li>
Create a unique id for the tag using the <code class="inline">dom_id</code> method and passing it arguments of <code class="inline">order</code> and the attribute on the order this specific tag is associate with, <code class="inline">&quot;name&quot;</code>. Pass the resulting value as the first argument to <code class="inline">turbo_frame_tag</code>.   </li>
  <li>
The html input for the part of the order the frame is associated with and a submit button (this could also be a partial).  </li>
</ol>
<p>
It will be used by rails to make sure it is both grabbing the correct html on the other side of the turbo frame and then again use it to populate the html reponse within the correct frame.</p>
<p>
/views/orders/partials/steps/step_1.rb</p>
<p>
Step 1</p>
<pre><code class="ruby">&lt;h1&gt;Name&lt;/h1&gt;
&lt;% name_frame_id = dom_id(order, &quot;name&quot;) %&gt;
&lt;%= turbo_frame_tag name_frame_id, data: { turbo_frame: name_frame_id } do %&gt;
  &lt;%= form.text_field :name %&gt;
  &lt;%= form.submit &quot;Continue Order&quot; %&gt;
&lt;% end %&gt;</code></pre>
<p>
/views/orders/partials/steps/step_2.rb</p>
<p>
Step 2</p>
<pre><code class="ruby">&lt;h1&gt;Toppings&lt;/h1&gt;
&lt;% toppings_frame_id = dom_id(order, &quot;toppings&quot;) %&gt;
&lt;%= turbo_frame_tag toppings_frame_id, data: { turbo_frame: toppings_frame_id } do %&gt;
  &lt;% Order::TOPPINGS.each do |topping| %&gt;
    &lt;br /&gt;
    &lt;%= form.check_box :toppings, {multiple: true}, topping, false %&gt;
    &lt;%= form.label topping %&gt;
  &lt;% end %&gt;
  &lt;%= form.submit &quot;Continue Order&quot; %&gt;
&lt;% end %&gt;</code></pre>
<p>
Now when you submit each form it will hit the update action in the controller async using Turbo Drive and redirect you to the edit path as long as the order still has steps to complete (in this example we stop the steps at 2). </p>
<p>
Further reading:</p>
<ul>
  <li>
<a href="2022-how-to-iterate-string-with-newlines-in-ruby.html" target="_blank">How to iterate a string containing newlines in Ruby</a>  </li>
  <li>
<a href="2022-how-to-replace-string-content-in-ruby.html" target="_blank">How to replace the contents of a string in Ruby</a>  </li>
</ul>

    </div>
  </div>
</div>

</main>

    <div id="privacy-policy-container">
      <a href="page/privacy.html">Privacy Policy</a>
      <div>Built with 🛠️ and ☕ in ⛰️</div>
    </div>

  </body>
</html>

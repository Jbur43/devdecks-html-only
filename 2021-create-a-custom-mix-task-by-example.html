<!DOCTYPE html>
<html lang="en">
  <head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2976969447542443"
     crossorigin="anonymous"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2F7W0VSKYS"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-2F7W0VSKYS');
    </script>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta charset="UTF-8" content="FlAjQwgdPyQzJDoFQWgMBnAqITE0BikVY1gwAlStrmID6-JdBzFfNTaq" csrf-param="_csrf_token" method-param="_method" name="csrf-token">
<meta content="elixir, mix" name="keywords"><meta content="Create a custom Mix task by example" name="description">
<title>Create a custom Mix task by example</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600&amp;display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600&amp;display=swap" rel="stylesheet">
    <link phx-track-static rel="stylesheet" href="css/app-02e14b945d8b05cb2897c7e476f6f184%EF%B9%96vsn=d.css"/>
    <script defer phx-track-static type="text/javascript" src="js/app-a031d7efdf9d092a14f7e85a21871ce8%EF%B9%96vsn=d.js"></script>
    <!-- SIDENAV SCRIPT -->
    <script type="text/javascript">
      /* Set the width of the side navigation to 250px */
      function openNav() {
        document.getElementById("mySidenav").style.width = "250px";
        document.getElementById("main").style.marginLeft = "250px";
        document.body.style.backgroundColor = "rgba(0,0,0,0.4)";

        var dropdown = document.getElementsByClassName("dropdown-btn");
        var i;
        for (i = 0; i < dropdown.length; i++) {
          dropdown[i].addEventListener("click", function() {
            this.classList.toggle("active");
            var dropdownContent = this.nextElementSibling;
            if (dropdownContent.style.display === "block") {
              dropdownContent.style.display = "none";
            } else {
              dropdownContent.style.display = "block";
            }
          });
        }
      }

      /* Set the width of the side navigation to 0 */
      function closeNav() {
        document.getElementById("mySidenav").style.width = "0";
        document.getElementById("main").style.marginLeft = "0";
        document.body.style.backgroundColor = "white";
      }
    </script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2976969447542443"
     crossorigin="anonymous"></script>
    <ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-2976969447542443"
     data-ad-slot="2745114693">
    </ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </head>
  <body>

    <div id="mySidenav" class="sidenav">
      <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
      <!-- FOR WHEN YOU NEED NESTED NAV USE THIS EXAMPLE -->
      <!-- <p class="dropdown-btn">Elixir Phoenix</p>
      <div class="dropdown-container">
        <a href="#">Link 1</a>
        <a href="#">Link 2</a>
      </div> -->
      <a href="page/about.html">About</a>
      <a href="page/attributions.html">Attributions</a>
    </div>

    <nav id="nav">
      <a href="index.html"><img id="logo" class="logo" src="images/logo-7c9e547c805c708decc674b648163720%EF%B9%96vsn=d.svg" alt="DevDecks icon" /></a>
      <a href="studio.html"><img id="settings-icon" class="nav-icon lg" src="images/studio-2-00b6814e1495c4cb9ff6987d9b98753f%EF%B9%96vsn=d.svg" alt="studio icon" /></a>
      <a id="darkmode-toggler"><img id="settings-icon" class="nav-icon" src="images/night-mode-41cf0bc8abaacbbd59e2fdca8ac55a85%EF%B9%96vsn=d.svg" alt="dark mode icon" /></a>
      <img id="settings-icon" onclick="openNav()" class="nav-icon" src="images/more-79c5db1b1206b6b8195fee1ceb385178%EF%B9%96vsn=d.svg" alt="more pages icon" />
    </nav>
    <br />
<main role="main" class="container">
  <p class="alert alert-info" role="alert"></p>
  <p class="alert alert-danger" role="alert"></p>
<div class="page blog-post">
  <div id="2021-create-a-custom-mix-task-by-example" style="margin-bottom: 3rem;">
<a class="all-posts-link" href="index.html">All posts</a>
    <div class="flex-row-d-column-m">
      <h1 class="link-title">Create a custom Mix task by example</h1>
      <time>2021-09-13</time>
    </div>

    <div class="flex-row-no-space">
      <img class="icon-sm" src="images/tag2-730d3eac769a667d071582853b151791%EF%B9%96vsn=d.svg" />&nbsp<a class="blog-tag" href="tags/elixir.html">elixir</a><a class="blog-tag" href="tags/mix.html">mix</a>
    </div>

    <div class="blog-post-body">
<p>
I am working on a task to migratie the DevDecks flashcard decks I created for this website to markdown files that will be rendering using NimblePublisher.</p>
<p>
These were the sub tasks I outlined for completing this task given I have no prior experience writing a custom mix tasks:</p>
<ol>
  <li>
Determine where to place the file for the task within my application  </li>
  <li>
Figure out the syntax for the task, is there a module definition format? What function will the task voke? Are there other modules I need to import?  </li>
  <li>
How do I run the custom mix task from the command line?  </li>
  <li>
How do I create, write, and close a file in Elixir?  </li>
  <li>
How do I include Ecto modules that will be needed for querying the database for the flashcard decks?  </li>
  <li>
Put it all together  </li>
</ol>
<h3>
  1) Determine where to place the file for the task within my application</h3>
<p>
I created a new directory and task file within devdecks/lib/dev_decks/tasks/migrate_db_posts_to_md.ex that would be used to define the task</p>
<h3>
  2) Figure out the syntax for the task, is there a module definition format? What function will the task voke? Are there other modules I need to import?</h3>
<p>
This is probably best illustrated with an annotated code example:</p>
<pre><code># define the module under mix.tasks namespace
defmodule Mix.Tasks.MigrateDbPostsToMd do
 @moduledoc ‚Äúconvert db posts to markdown posts&quot;
 # include the Mix.Task code
 use Mix.Task
 
 # define a run/1 function that will be invoked when your task is executed
 def run(_) do
   IO.puts(&quot;RUNNING!&quot;)
 end
end</code></pre>
<h3>
  3) How do I run the custom mix task from the command line?</h3>
<p>
The command for the task is going to be the snake case version of the module you created for the task. So in this example from the root directory of the application I execute <code class="inline">mix migrate_db_posts_to_md</code>. </p>
<h3>
  4) How do I create and write to a file in Elixir?</h3>
<p>
Through the use of Elixir‚Äôs <code class="inline">File</code> module there is a <code class="inline">write!/3</code> function that will create a file if one doesn‚Äôt exist at the specified path and write the contents provided to it as the second argument, ex:</p>
<pre><code>File.write!(‚Äú/path/to/new_or_existing_file.md‚Äù, contents)</code></pre>
<h3>
  5) How do I include Ecto modules that will be needed for querying the database for the flashcard decks?</h3>
<p>
You just include them as you would inside any other Elixir module inside your Phoenix application, but now your task must start the application in order to have access to those modules through <code class="inline">Mix.Task.run(&quot;app.start&quot;)</code>, the result of all the changes looked like this in my case:</p>
<pre><code>defmodule Mix.Tasks.MigrateDbPostsToMd do
 @moduledoc &quot;convert db posts to markdown posts&quot;
 use Mix.Task
 import Ecto.Query
 alias DevDecks.Repo
 alias DevDecks.Deck
 
 
 def run(_) do
   # Need this to get repo
   Mix.Task.run(&quot;app.start&quot;)
 
   IO.puts(&quot;BLURP&quot;)
 end
end
</code></pre>
<h3>
  Put it all together</h3>
<pre><code>defmodule Mix.Tasks.MigrateDbPostsToMd do
 @moduledoc &quot;convert db posts to markdown posts&quot;
 use Mix.Task
 import Ecto.Query
 alias DevDecks.Repo
 alias DevDecks.Deck
 
 def run(_) do
   Mix.Task.run(&quot;app.start&quot;)
 
   Deck |&gt; Ecto.Query.select([:title]) |&gt; Repo.all |&gt; Enum.with_index |&gt; Enum.each(fn({deck, i}) -&gt;
       File.write(&quot;priv/posts/scheduled/post#{i}&quot;, deck.title)
   end)
 end
end</code></pre>
<p>
And the newly built files:</p>
<image src="/images/blog/custom-mix-ouput.gpng" alt="my_picture">
</image>

    </div>
  </div>
</div>

</main>

    <div id="privacy-policy-container">
      <a href="page/privacy.html">Privacy Policy</a>
      <div>Built with üõ†Ô∏è and ‚òï in ‚õ∞Ô∏è</div>
    </div>

  </body>
</html>
